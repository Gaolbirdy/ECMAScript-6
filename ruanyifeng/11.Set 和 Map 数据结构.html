<script>
    const { log } = console;
</script>

<!-- <script>
    // const s = new Set();
    // log(s, typeof s);

    // [2, 3, 5, 4, 5, 2, 2].forEach(x => s.add(x));
    
    // for(let i of s) {
    //     log(i);
    // }

    // const set = new Set([1, 2, 3 ,4 ]);
    // log(set);
    // log([...set]);

    // const items = new Set([1, 2, 3, 4, 5, 5, 5, 5]);
    // log(items.size);

    // const set = new Set(document.querySelectorAll('div'));
    // log(set);
    // log(set.size);

    // const set = new Set();
    // document.querySelectorAll('div').forEach(div => set.add(div));
    // log(set.size);

    // log(...[1, 2, 3, 3]);
    // log(...new Set([1, 2, 3, 3]));

    // let set = new Set();
    // let a = NaN;
    // let b = NaN;
    // let c = undefined;
    // let d = null;
    // set.add(a);
    // set.add(b);
    // set.add(c);
    // set.add(d);
    // log(set);

    let set = new Set();
    set.add({});
    log(set.size);

    set.add({});
    log(set.size);
    log(set);
</script> -->

<!-- <script>
    // let s = new Set();
    // s.add(1).add(2).add(2);

    // log(s.size);

    // log(s.has(1));
    // log(s.has(2));
    // log(s.has(3));

    // s.delete(2);
    // log(s.has(2));

    // const propertiyes = {
    //     'width': 1,
    //     'height': 1
    // };

    // if(propertiyes['width'])
    //     log(propertiyes['width']);

    // const propertiyes = new Set();

    // propertiyes.add('width');
    // propertiyes.add('height');

    // if(propertiyes.has('width'))
    //     log(propertiyes);

    // const items = new Set([1, 2, 3, 4, 5]);
    // const array = Array.from(items);
    // log(array);

    // function dedupe(array) {
    //     return Array.from(new Set(array));
    // }

    // log(dedupe([1, 1, 2, 3]));

    // let set = new Set(['red', 'green', 'blue']);

    // // log(set.keys());
    // for(let item of set.keys()) {
    //     log(item);
    // }

    // for(let item of set.values()) {
    //     log(item);
    // }

    // for(let item of set.entries()) {
    //     log(item);
    // }

    // log(Set.prototype[Symbol.iterator] === Set.prototype.values);

    // let set = new Set(['red', 'green', 'blue']);

    // for(let x of set){
    //     log(x);
    // }

    // let  set = new Set([1, 4, 9]);
    // set.forEach((value, key) => log(key + ' : ' + value));

    // let set = new Set(['red', 'green', 'bule']);
    // let arr = [...set];
    // log(arr);

    // let arr = [3, 5, 2, 2, 5, 5];
    // let unique = [...new Set(arr)];
    // log(unique);

    // let set = new Set([1, 2, 3, 2]);
    // set = new Set([...set].map(x => x * 2));
    // log(set);

    // let set = new Set([1, 2, 3, 4, 5]);
    // set = new Set([...set].filter(x => (x % 2) == 0));
    // log(set);

    // let a = new Set([1, 2, 3]);
    // let b = new Set([4, 3, 2]);

    // // log(new Set([[1, 2], [2, 3]]));
    // let union = new Set([...a, ...b]);
    // log(union);

    // let intersect = new Set([...a].filter(x => b.has(x)));
    // log(intersect);

    // let difference = new Set([...a].filter(x => !b.has(x)));
    // log(difference);

    // let set = new Set([1, 2, 3]);
    // set = new Set([...set].map(val => val * 2));
    // log(set);

    let set = new Set([1, 2, 3]);
    set = new Set(Array.from(set, val => val * 2));
    log(set);
</script> -->

<!-- <script>
    // const ws = new WeakSet();
    // ws.add(1);
    // ws.add(Symbol());

    // const ws = new WeakSet([1, 2]);

    // const a = [[1, 2], [3, 4]];
    // const ws = new WeakSet(a);
    // log(ws);

    // const ws = new WeakSet();
    // const obj = {};
    // const foo = {};

    // ws.add(window);
    // ws.add(obj);

    // log(ws);
    // log(ws.has(window));
    // log(ws.has(foo));

    // ws.delete(window);
    // log(ws.has(window));

    // log(ws.size);
    // log(ws.forEach);

    // ws.forEach(function(item) { log('WeakSet has ' + item)});

    const foos = new WeakSet();
    class Foo {
        constructor() {
            foos.add(this);
        }

        method() {
            if(!foos.has(this))
                throw new TypeError('Foo.prototype.method 只能在Foo的实例上调用！');
        }
    }
</script> -->

<div id='myDiv'>
    
</div>
<!-- <script>
    // const data = {};
    // const element = document.getElementById('myDiv');
    
    // data[element] = 'metadata';
    // log(data);
    // log(data['[object HTMLDivElement]']);

    // const m = new Map();
    // const o = {p: 'Hello World'};

    // m.set(o, 'content');
    // log(m);
    // log(m.get(o));

    // log(m.has(o));
    // m.delete(o);
    // log(m.has(o));

    // const map = new Map([
    //     ['name', '张三'],
    //     ['title', 'Author']
    // ]);

    // log(map.size);
    // log(map.has('name'));
    // log(map.get('name'));
    // log(map.has('title'));
    // log(map.get('title'));

    // const items = [
    //     ['name', '张三'],
    //     ['title', 'Author']
    // ];

    // const map = new Map();
    // items.forEach(
    //     ([key, value]) => map.set(key, value)
    // );
    // log(map);

    // const set = new Set([
    //     ['foo', 1],
    //     ['bar', 2]
    // ]);

    // const m1 = new Map(set);
    // log(m1);
    // log(m1.get('foo'));

    // const m2 = new Map([['baz', 3]]);
    // const m3 = new Map(m2);
    // log(m3);
    // log(m3.get('baz'));

    // const map = new Map();
    // map
    // .set(1, 'aaa')
    // .set(1, 'bbb');

    // log(map.get(1));

    // log(new Map().get('adfadadsf'));

    // const map = new Map();
    // // let o = ['a'];

    // // map.set(o, 555);
    // // log(map.get(o));
    // // log(map.get(['a']));

    // map.set(['a'], 555);
    // log(map.get(['a']));
    // log(map);

    // const map = new Map();

    // const k1 = ['a'];
    // const k2 = ['a'];

    // map
    // .set(k1, 111)
    // .set(k2, 222);

    // log(map);
    // log(map.get(['a']));
    // log(map.get(k1));
    // log(map.get(k2));

    // log(typeof k1);
    // log(k2 == k1);
    // log(k2 === k1);
    // log(k2 == ['a']);
    // log(k2 === ['a']);
    // log(['a'] == ['a']);
    // log(['a'] === ['a']);

    // let map = new Map();

    // map.set(-0, 123);
    // log(map.get(+0));

    // map.set(true, 1);
    // map.set('true', 2);
    // log(map.get(true));

    // map.set(undefined, 3);
    // map.set(null, 4);
    // log(map.get(undefined));

    // map.set(NaN, 123);
    // map.set(NaN, 456);
    // log(map.get(NaN));

    // log(map);
    // log(map.size);

    // const map = new Map();
    // map.set('foo', true);
    // map.set('bar', false);

    // log(map.size);

    // const m = new Map();
    
    // m.set('edition', 6);
    // m.set(262, 'standard');
    // m.set(undefined, 'nah');
    // log(m);

    // let map = new Map()
    //     .set(1, 'a')
    //     .set(2, 'b')
    //     .set(3, 'c');
    // log(map);

    // const m = new Map();

    // const hello = function() {log('hello');};
    // m.set(hello, 'Hello ES6!');

    // log(m);
    // log(m.get(hello));

    // const m = new Map();

    // // m.set('edition', 6);
    // // m.set(262, 'standard');
    // // m.set(undefined, 'nah');

    // // log(m.has('edition'));
    // // log(m.has('years'));
    // // log(m.has(262));
    // // log(m.has(undefined));

    // // m.set(undefined, 'nah');
    // // log(m.has(undefined));

    // // log(m.delete(undefined));
    // // log(m.has(undefined));
    // // log(m.delete(undefined));

    // m.set('foo', true);
    // m.set('bar', false);

    // log(m.size);
    // m.clear();
    // log(m.size);

    // const map = new Map([
    //     ['F', 'no'],
    //     ['T', 'yes'],
    // ]);

    // for(let key of map.keys()){
    //     log(key);
    // }

    // for(let value of map.values()){
    //     log(value);
    // }

    // for(let item of map.entries()){
    //     log(item);
    //     log(item[0], item[1]);
    // }

    // for(let [key, value] of map.entries()){
    //     log(key, value);
    // }

    // for(let [key, value] of map){
    //     log(key, value);
    // }

    // log(map[Symbol.iterator] === map.entries);

    // const map = new Map([
    //     [1, 'one'],
    //     [2, 'two'],
    //     [3, 'three'],
    // ]);

    // log(...map.keys());
    // log([...map.keys()]);

    // log([...map.values()]);
    // log([...map.entries()]);
    // log([...map]);
    // log(...map);

    // const map0 = new Map()
    //     .set(1, 'a')
    //     .set(2, 'b')
    //     .set(3, 'c');

    // const map1 = new Map([...map0].filter(([k, v]) => k < 3));
    // log(map1);

    // const map2 = new Map([...map0].map(([k, v]) => [k * 2, '_' + v]));
    // log(map2);

    // map0.forEach(function(value, key, map0) {
    //     log("Key: %s, Value: %s", key, value);
    // });

    // const reporter = {
    //     report: function(key, value) {
    //         log("Key: %s, Value: %s", key, value);
    //     }
    // };

    // map0.forEach(function(value, key, map) {
    //     this.report(key, value);
    //     log(this);
    // }, reporter);

    // const myMap = new Map()
    //     .set(true, 7)
    //     .set({foo: 3}, ['abc']);
    // log(...myMap);
    // log([...myMap]);

    // const m = new Map([
    //     [true, 7],
    //     [{foo: 3}, ['abc']]
    // ]);
    // log(m);

    // function strMapToObj(strMap) {
    //     let obj = Object.create(null);
    //     for(let [k, v] of strMap) {
    //         obj[k] = v;
    //     }
    //     return obj;
    // }

    // const myMap = new Map()
    //     .set('yes', true)
    //     .set('no', false)
    //     .set(undefined, 1);
    // log(strMapToObj(myMap));

    // function objToStrMap(obj) {
    //     let strMap = new Map();
    //     for(let k of Object.keys(obj)) {
    //         // strMap.set(k, obj.k);
    //         strMap.set(k, obj[k]);
    //     }

    //     return strMap;
    // }

    // log(objToStrMap({yes: true, no: false}));

    // function strMapToJson(strMap) {
    //     return JSON.stringify(strMapToObj(strMap));
    // }

    // let myMap = new Map().set('yes', true).set('no', false);
    // log(strMapToJson(myMap));

    // function mapToArrayJson(map) {
    //     return JSON.stringify([...map]);
    // }

    // let myMap = new Map().set(true, 7).set({foo: 3}, ['abc']);
    // log(mapToArrayJson(myMap));

    // function jsonToStrMap(jsonStr) {
    //     return objToStrMap(JSON.parse(jsonStr));
    // }

    // log(jsonToStrMap('{"yes": true, "no": false}'));

    function jsonToMap(jsonStr) {
        return new Map(JSON.parse(jsonStr));
    }

    log(jsonToMap('[[true,7], [{"foo":3},["abc"]]]'));
</script> -->

<div id='foo'></div>
<div id='bar'></div>
<div id='example'></div>
<div id='logo'></div>
<script>
    // const wm1 = new WeakMap();
    // const key = {foo: 1};
    // wm1.set(key, 2);
    // log(wm1.get(key));

    // const k1 = [1, 2, 3];
    // const k2 = [4, 5, 6];
    // const wm2 = new WeakMap([[k1, 'foo'], [k2, 'bar']]);
    // log(wm2.get(k2));

    // const map = new WeakMap();
    // map.set(1, 2);
    // map.set(Symbol(), 2);
    // map.set(null, 2);

    // const e1 = document.getElementById('foo');
    // const e2 = document.getElementById('bar');
    // const arr = [
    //     [e1, 'foo元素'],
    //     [e2, 'bar元素']
    // ];

    // arr[0] = null;
    // arr[1] = null;

    // const wm = new WeakMap();
    
    // const element = document.getElementById('example');

    // wm.set(element, 'some informatoin');
    // log(wm.get(element));

    // const wm = new WeakMap();
    // let key = {};
    // let obj = {foo: 1};

    // wm.set(key, obj);
    // obj = null;
    // log(wm.get(key));

    // const wm = new WeakMap();

    // log(wm.size);
    // log(wm.forEach);
    // log(wm.clear);

    // let myElement = document.getElementById('logo');
    // let myWeakmap = new WeakMap();

    // myWeakmap.set(myElement, {timesClicked: 0});

    // myElement.addEventListener('click', function() {
    //     let logoData = myWeakmap.get(myElement);
    //     logoData.timesClicked++;
    // }, false);

    const _counter = new WeakMap();
    const _action = new WeakMap();

    class Countddown {
        constructor(counter, action) {
            _counter.set(this, counter);
            _action.set(this, action);
        }
        dec() {
            let counter = _counter.get(this);
            if(counter < 1) return;
            counter--;
            _counter.set(this, counter);
            if(counter === 0) {
                _action.get(this)();
            }
        }
    }

    let c = new Countddown(2, () => log('DONE'));

    c.dec();
    c.dec();

    c = null;
    log(_counter);
</script>